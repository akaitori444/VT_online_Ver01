<!DOCTYPE html>
<html lang="je">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>VT_online_ãƒ‡ãƒ¢ç‰ˆ</title>
      <!--ãƒªã‚»ãƒƒãƒˆCSS-->
      <link rel="canonical" href="#">
      <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.15.4/css/all.css">
      <link rel="stylesheet" type="text/css" href="css/main.css"/>
  </head>

  <body>
    <div class="game_view">
      <div id="game-container"></div>
      <div>
        <!-- å…¥åŠ›å ´æ‰€ -->
        <form>
          <fieldset class="">
            <legend>ãƒãƒ£ãƒƒãƒˆå…¥åŠ›</legend>
            <div>
              åå‰: <input type="text" id="name">
            </div>
            <div>
              æœ¬æ–‡: <input type="text" id="text">
            </div>
            <div>
              <button type="button" id="send">é€ã‚‹</button>
            </div>
          </fieldset>
        </form>
        <!-- ãƒ‡ãƒ¼ã‚¿å‡ºåŠ›å ´æ‰€ -->
        <div class="chat">
          <ul id="output"></ul>
        </div>
      </div>
    </div>


  

  
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script>
      // æ—¥æ™‚ã‚’ã„ã„æ„Ÿã˜ã®å½¢å¼ã«ã™ã‚‹é–¢æ•°
      function convertTimestampToDatetime(timestamp) {
        const _d = timestamp ? new Date(timestamp * 1000) : new Date();
        const Y = _d.getFullYear();
        const m = (_d.getMonth() + 1).toString().padStart(2, '0');
        const d = _d.getDate().toString().padStart(2, '0');
        const H = _d.getHours().toString().padStart(2, '0');
        const i = _d.getMinutes().toString().padStart(2, '0');
        const s = _d.getSeconds().toString().padStart(2, '0');
        //return `${Y}/${m}/${d} ${H}:${i}:${s}`;
        return `${m}/${d} ${H}:${i}`;
      }
    </script>
    <!-- ä»¥ä¸‹ã«firebaseã®ã‚³ãƒ¼ãƒ‰ã‚’è²¼ã‚Šä»˜ã‘ã‚ˆã† -->
    <script type="module">
      // Import the functions you need from the SDKs you need
      import { initializeApp } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-app.js";
      // TODO: Add SDKs for Firebase products that you want to use
      // https://firebase.google.com/docs/web/setup#available-libraries
    
      // Your web app's Firebase configuration
      const firebaseConfig = {

      };
    
      // Initialize Firebase
      const app = initializeApp(firebaseConfig);
  
  //ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼//
  //           è¿½åŠ åˆ†
  //ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼//
  
    // ğŸ”½ è¿½åŠ  / `9.2.0`ã®éƒ¨åˆ†ã‚’â†‘ã®Firestoreã‹ã‚‰è²¼ã‚Šä»˜ã‘ãŸã‚³ãƒ¼ãƒ‰ã®ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã«åˆã‚ã›ã‚‹
      import {
        getFirestore,
        collection,
        addDoc,
        serverTimestamp,
        query,
        orderBy,
        onSnapshot,
      } from "https://www.gstatic.com/firebasejs/9.14.0/firebase-firestore.js";
  
  
      // ğŸ”½ è¿½åŠ 
      const db = getFirestore(app);
  
  //ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼ãƒ¼//
  
      $("#send").on("click", function () {
        // é€ä¿¡æ™‚ã«å¿…è¦ãªå‡¦ç†
        const postData = {
          name: $("#name").val(),
          text: $("#text").val(),
          time: serverTimestamp(),
        };
        addDoc(collection(db, "chat"), postData);
        $("#text").val("");
            });
  
    // queryã‚’ä½¿ã£ã¦æ™‚é–“é †ã«å¤‰æ›´
    // æ˜‡é †ï¼ˆascï¼‰ã‹é™é †ï¼ˆdescï¼‰
        const q = query(collection(db, "chat"), orderBy("time", "desc"));
  
    // ãƒ‡ãƒ¼ã‚¿å–å¾—å‡¦ç†
      onSnapshot(q, (querySnapshot) => {
  
        //console.log(querySnapshot.docs);
        const documents = [];
        querySnapshot.docs.forEach(function (doc) {
          const document = {
            id: doc.id,
            data: doc.data(),
          };
          documents.push(document);
        });
        console.log(documents);
  
    // ãƒ‡ãƒ¼ã‚¿å…¥åŠ›å‡¦ç†
        const htmlElements = [];
        documents.forEach(function (document) {
          htmlElements.push(`
            <li id="${document.id}">
              <p class="plname" style="color: red;font-weight:bold;">${document.data.name} </p>
              <p>æŠ•ç¨¿æ™‚åˆ» ã€${convertTimestampToDatetime(document.data.time.seconds)}ã€‘</p>
              <p>${document.data.text}</p>
            </li>
          `);
        });
  
        $("#output").html(htmlElements);
        console.log(documents.length);
        //localStorage.setItem(documents.length);
      });
    </script>

    <script src="//cdn.jsdelivr.net/npm/phaser@3.55.2/dist/phaser.js"></script>
    <script src="./js/index.js" type="module"></script>

  </body>


</html>
